df$risk<-ifelse(df$doy>=124 & df$doy<=140 & df$species=="BETALL", 10, df$risk)
df$risk<-ifelse(df$doy>=90 & df$doy<=94 & df$species=="ILEMUC", 3, df$risk)
df$risk<-ifelse(df$doy>=90 & df$doy<=120 & df$species=="BETALL", 3, df$risk)
df$risk<-ifelse(df$doy>=101 & df$species=="ILEMUC", 5, df$risk)
df$risk<-ifelse(df$doy>=146 & df$species=="BETALL", 5, df$risk)
View(df)
df$risk<-ifelse(df$doy>=96 && df$doy<=99 && df$species=="ILEMUC", 10, df$risk)
View(df)
doy<- 90:150
ile<-data.frame(doy, phase=NA, risk=NA)
ile$phase<-ifelse(ile$doy==95, "BB", ile$phase)
ile$phase<-ifelse(ile$doy==100, "LO", ile$phase)
ile$risk<-ifelse(ile$doy>=96 && ile$doy<=99, 10, ile$risk)
ile$risk<-ifelse(ile$doy>=90 & ile$doy<=94, 3, ile$risk)
ile$risk<-ifelse(ile$doy>=101, 5, ile$risk)
View(ile)
ile$risk<-ifelse(ile$doy>=96 & ile$doy<=99, 10, ile$risk)
bet<-data.frame(doy, phase=NA, risk=NA)
bet$phase<-ifelse(bet$doy==122, "BB", bet$phase)
bet$phase<-ifelse(bet$doy==142, "LO", bet$phase)
bet$risk<-ifelse(bet$doy>=124 & bet$doy<=140, 10, bet$risk)
bet$risk<-ifelse(bet$doy>=90 & bet$doy<=120, 3, bet$risk)
bet$risk<-ifelse(bet$doy>=146, 5, bet$risk)
View(bet)
ile<-ggplot(ile, aes(x=doy, y=risk)) + geom_line()
library(ggplot)
library(ggplot2)
ile<-ggplot(ile, aes(x=doy, y=risk)) + geom_line()
ile
doy<- 75:150
ile<-data.frame(doy, phase=NA, risk=NA)
ile$phase<-ifelse(ile$doy==95, "BB", ile$phase)
ile$phase<-ifelse(ile$doy==100, "LO", ile$phase)
ile$risk<-ifelse(ile$doy>=96 & ile$doy<=99, 10, ile$risk)
ile$risk<-ifelse(ile$doy>=75 & ile$doy<=94, 3, ile$risk)
ile$risk<-ifelse(ile$doy>=101, 5, ile$risk)
bet<-data.frame(doy, phase=NA, risk=NA)
bet$phase<-ifelse(bet$doy==122, "BB", bet$phase)
bet$phase<-ifelse(bet$doy==142, "LO", bet$phase)
bet$risk<-ifelse(bet$doy>=124 & bet$doy<=140, 10, bet$risk)
bet$risk<-ifelse(bet$doy>=75 & bet$doy<=120, 3, bet$risk)
bet$risk<-ifelse(bet$doy>=146, 5, bet$risk)
ile<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + geom_point()
ile
ile<-ggplot(ile, aes(x=doy, y=risk)) + geom_line()
ile<-ggplot(ile, aes(x=doy, y=risk)) + geom_line()
doy<- 75:150
ile<-data.frame(doy, phase=NA, risk=NA)
ile$phase<-ifelse(ile$doy==95, "BB", ile$phase)
ile$phase<-ifelse(ile$doy==100, "LO", ile$phase)
ile$risk<-ifelse(ile$doy>=96 & ile$doy<=99, 10, ile$risk)
ile$risk<-ifelse(ile$doy>=75 & ile$doy<=94, 3, ile$risk)
ile$risk<-ifelse(ile$doy>=101, 5, ile$risk)
bet<-data.frame(doy, phase=NA, risk=NA)
bet$phase<-ifelse(bet$doy==122, "BB", bet$phase)
bet$phase<-ifelse(bet$doy==142, "LO", bet$phase)
bet$risk<-ifelse(bet$doy>=124 & bet$doy<=140, 10, bet$risk)
bet$risk<-ifelse(bet$doy>=75 & bet$doy<=120, 3, bet$risk)
bet$risk<-ifelse(bet$doy>=146, 5, bet$risk)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line()
ilemuc
doy<- 75:150
ile<-data.frame(doy, phase=NA, risk=NA)
ile$phase<-ifelse(ile$doy==95, "BB", ile$phase)
ile$phase<-ifelse(ile$doy==100, "LO", ile$phase)
ile$risk<-ifelse(ile$doy>=96 & ile$doy<=99, 10, ile$risk)
ile$risk<-ifelse(ile$doy==95, 6.5, ile$risk)
ile$risk<-ifelse(ile$doy==100, 7.5, ile$risk)
ile$risk<-ifelse(ile$doy>=75 & ile$doy<=94, 3, ile$risk)
ile$risk<-ifelse(ile$doy>=101, 5, ile$risk)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line()
ilemuc
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:10)
ilemuc
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20)
ilemuc
bet<-data.frame(doy, phase=NA, risk=NA)
bet$phase<-ifelse(bet$doy==122, "BB", bet$phase)
bet$phase<-ifelse(bet$doy==142, "LO", bet$phase)
bet$risk<-ifelse(bet$doy>=124 & bet$doy<=140, 10, bet$risk)
ile$risk<-ifelse(ile$doy==123, 6.5, ile$risk)
ile$risk<-ifelse(ile$doy==141, 7.5, ile$risk)
bet$risk<-ifelse(bet$doy>=75 & bet$doy<=122, 3, bet$risk)
bet$risk<-ifelse(bet$doy>=142, 5, bet$risk)
betall<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20)
betall
bet<-data.frame(doy, phase=NA, risk=NA)
bet$phase<-ifelse(bet$doy==122, "BB", bet$phase)
bet$phase<-ifelse(bet$doy==142, "LO", bet$phase)
bet$risk<-ifelse(bet$doy>=124 & bet$doy<=140, 10, bet$risk)
ile$risk<-ifelse(bet$doy==123, 6.5, bet$risk)
ile$risk<-ifelse(bet$doy==141, 7.5, bet$risk)
bet$risk<-ifelse(bet$doy>=75 & bet$doy<=122, 3, bet$risk)
bet$risk<-ifelse(bet$doy>=142, 5, bet$risk)
betall<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20)
betall
bet<-data.frame(doy, phase=NA, risk=NA)
bet$phase<-ifelse(bet$doy==122, "BB", bet$phase)
bet$phase<-ifelse(bet$doy==142, "LO", bet$phase)
bet$risk<-ifelse(bet$doy>=124 & bet$doy<=140, 10, bet$risk)
bet$risk<-ifelse(bet$doy==123, 6.5, bet$risk)
bet$risk<-ifelse(bet$doy==141, 7.5, bet$risk)
bet$risk<-ifelse(bet$doy>=75 & bet$doy<=122, 3, bet$risk)
bet$risk<-ifelse(bet$doy>=142, 5, bet$risk)
betall<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20)
betall
betall<-ggplot(bet, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20)
betall
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
library(gridExtra)
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
geom_label(x = 82:97, y = 1:6)
ilemuc
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotation_custom(df, xmin=82, xmax=97, ymin=1, ymax=6)
ilemuc
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0)
ilemuc
doy<- 75:150
ile<-data.frame(doy, phase=NA, risk=NA)
ile$phase<-ifelse(ile$doy==95, "BB", ile$phase)
ile$phase<-ifelse(ile$doy==100, "LO", ile$phase)
ile$risk<-ifelse(ile$doy>=96 & ile$doy<=99, 10, ile$risk)
ile$risk<-ifelse(ile$doy==95, 6.5, ile$risk)
ile$risk<-ifelse(ile$doy==100, 7.5, ile$risk)
ile$risk<-ifelse(ile$doy>=75 & ile$doy<=94, 3, ile$risk)
ile$risk<-ifelse(ile$doy>=101, 5, ile$risk)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0)
ilemuc
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.2)
ilemuc
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.2, color="red")
ilemuc
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, color="red")
ilemuc
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red")
ilemuc
doy<- 75:150
ile<-data.frame(doy, phase=NA, risk=NA)
ile$phase<-ifelse(ile$doy==95, "BB", ile$phase)
ile$phase<-ifelse(ile$doy==100, "LO", ile$phase)
ile$risk<-ifelse(ile$doy>=96 & ile$doy<=99, 10, ile$risk)
ile$risk<-ifelse(ile$doy==95, 6.5, ile$risk)
ile$risk<-ifelse(ile$doy==100, 7.5, ile$risk)
ile$risk<-ifelse(ile$doy>=75 & ile$doy<=94, 3, ile$risk)
ile$risk<-ifelse(ile$doy>=101, 4, ile$risk)
bet<-data.frame(doy, phase=NA, risk=NA)
bet$phase<-ifelse(bet$doy==122, "BB", bet$phase)
bet$phase<-ifelse(bet$doy==142, "LO", bet$phase)
bet$risk<-ifelse(bet$doy>=124 & bet$doy<=140, 10, bet$risk)
bet$risk<-ifelse(bet$doy==123, 6.5, bet$risk)
bet$risk<-ifelse(bet$doy==141, 7.5, bet$risk)
bet$risk<-ifelse(bet$doy>=75 & bet$doy<=122, 3, bet$risk)
bet$risk<-ifelse(bet$doy>=142, 4, bet$risk)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red")
betall<-ggplot(bet, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red")
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140:150, y = 25, label = "ILEMUC")
betall<-ggplot(bet, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140:150, y = 25, label = "BETALL")
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140:150, y = 18, label = "ILEMUC")
betall<-ggplot(bet, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140:150, y = 18, label = "BETALL")
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140, y = 18, label = "ILEMUC")
betall<-ggplot(bet, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140, y = 18, label = "BETALL")
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140, y = 18, label = "Ilex mucronata")
betall<-ggplot(bet, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140, y = 18, label = "Betula alleghaniensis")
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140, y = 18, label = "Ilex mucronata")
betall<-ggplot(bet, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 135, y = 18, label = "Betula alleghaniensis")
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140, y = 18, label = "Ilex mucronata")
betall<-ggplot(bet, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 137, y = 18, label = "Betula alleghaniensis")
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
ilemuc<-ggplot(ile, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140, y = 18, label = "Ilex mucronata")
betall<-ggplot(bet, aes(x=doy, y=risk)) + geom_line() + coord_cartesian(ylim=0:20) +
annotate("rect", xmin=82, xmax=97, ymin=1, ymax=6, alpha=0.1, color="red") +
xlab("Day of Year") + ylab("Frost Damage Risk") +
annotate("text", x = 140, y = 18, label = "Betula alleghaniensis")
grid.arrange(ilemuc, betall, ncol=1, nrow=2)
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
# Load libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
library(lme4)
library(arm)
# Set Working Directory
setwd("~/Documents/git/freezingexperiment/analyses")
d <-read.csv("input/buds_traits.csv", header=TRUE)
bb<-read.csv("input/birches_buddata.csv", header=TRUE)
bb<-read.csv("output/birches_buddata.csv", header=TRUE)
View(bb)
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
# Load libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
library(lme4)
library(arm)
library(gridExtra)
# Set Working Directory
setwd("~/Documents/git/freezingexperiment/analyses")
d <-read.csv("input/Buds_clean.csv", header=TRUE, check.names=FALSE)
################ Cleaning data ##################################
# remove individuals that were frosted twice
error.inds<-d%>%dplyr::select(NEW,Freeze)
error.inds<-error.inds[!duplicated(error.inds),]
#error.inds$Freeze<-ifelse(error.inds$Freeze=="", NA, error.inds$Freeze)
#error.inds<-na.omit(error.inds)
error.inds<-as.data.frame(table(error.inds$NEW))
error.inds<-filter(error.inds, Freq!=3)
keep<-unique(error.inds$Var1)
## Clean dataframe for analysis
dx<-gather(d, key=doy, value=bbch, -NEW, -TX, -Freeze, -Bud)
dx<-filter(dx, NEW %in% keep)
dx$day<-substr(dx$doy, 1, 2)
dx$month<-substr(dx$doy, 4, 5)
dx$year<-substr(dx$doy, 7,10)
x<-paste(dx$year, dx$day, dx$month)
dx$date<-as.Date(strptime(x, format="%Y %d %m"))
dx$doy<-yday(dx$date)
### DOY should now be adjusted for start of experiment rather than actual calendar doy
# Start of Experiment was: 24 March 2017
start<-yday("2017/03/24")
dx$doy.adjusted<-dx$doy-start
dx$bud <- ave(dx$Bud, dx$NEW, dx$date, FUN = seq_along)
# Quick check...
dvr<-dx[!is.na(dx$bbch),]
done<-c("DONE!", "DONE", "DONE!!", "missed","(missed)", "")
dvr<-dvr[!dvr$bbch%in%done,]
dead<-c("stem snapped", "x", "dead")
dvr$bbch<-ifelse(dvr$bbch%in%dead, 0, dvr$bbch)
dvr$bud<-as.numeric(dvr$bud)
dvr$ID<-paste(dvr$NEW, dvr$bud, sep="_")
dvr<-dvr%>%dplyr::select(ID, doy.adjusted, bbch)
last<-aggregate(dvr$doy.adjusted, by = list(dvr$ID), max)
last<-last%>%rename(ID=Group.1)%>%rename(doy.adjusted=x)
last$leaf<-NA
for(i in c(1:nrow(last))) {
for(j in c(1:nrow(dvr)))
if(last$ID[i]==dvr$ID[j] & last$doy.adjusted[i]==dvr$doy.adjusted[j])
last$leaf[i]<-dvr$bbch[j]
}
first<-aggregate(dvr$doy.adjusted, by = list(dvr$ID), min)
first<-first%>%rename(ID=Group.1)%>%rename(doy.adjusted=x)
first$bb<-NA
for(i in c(1:nrow(first))) {
for(j in c(1:nrow(dvr)))
if(first$ID[i]==dvr$ID[j] & first$doy.adjusted[i]==dvr$doy.adjusted[j])
first$bb[i]<-dvr$bbch[j]
}
############## Determine Duration of Vegetative Risk #################
##### Need to clean data a lot - remove early incorrectly entered data
## and edit errors from when I was away
## then determine dead buds and if any reached budburst and then died
## If so to above, need to recalculate percent budburst
first<-first%>%rename(budburst=doy.adjusted)%>%rename(bbch.first=bb)
last<-last%>%rename(leafout=doy.adjusted)%>%rename(bbch.last=leaf)
risk<-full_join(first, last)
risk$species<-substr(risk$ID, 1,6)
risk$individ<-substr(risk$ID, 1, 10)
risk$bud<-substr(risk$ID, 12, 13)
###### Now integrate FS ###########
frz<-subset(dx,TX=="B")
frz<-dplyr::select(frz, NEW, Freeze, bud)
frz$day<-substr(frz$Freeze, 1, 2)
frz$month<-substr(frz$Freeze, 4, 5)
frz$year<-substr(frz$Freeze, 7,10)
x<-paste(frz$year, frz$day, frz$month)
frz$date<-as.Date(strptime(x, format="%Y %d %m"))
frz$frz<-yday(frz$date)
frz<-dplyr::select(frz, NEW, frz)
frz<-na.omit(frz)
frz<-frz[!duplicated(frz),]
risk$frz<-NA
for(i in c(1:nrow(risk))) {
for(j in c(1:nrow(frz)))
if(risk$individ[i]==frz$NEW[j])
risk$frz[i]<-frz$frz[j]
}
risk$frz<- risk$frz-start
risk$tx<-ifelse(is.na(risk$frz), "A", "B")
risk$dvr<-ifelse(risk$bbch.last==15, (risk$leafout-risk$budburst), NA)
risk$frost<-ifelse(risk$bbch.first<=risk$frz, 1, 0)
risk$frost<-ifelse(risk$tx=="A", 0, risk$frost)
risk$bud<-as.numeric(risk$bud)
mod1<-lm(dvr~bud+species+frost, data=birch)
display(mod1)
betula<-c("BETPOP", "BETPAP")
birch<-subset(risk, risk$species%in%betula)
mod2<-glm(dvr~bud+species+frost, data=birch)
display(mod2)
mod3<-glm(dvr~species+bud*tx, data=birch)
display(mod3)
mod4<-lmer(dvr~bud+frost+(1|species), data=birch)
display(mod4)
bpap<-ggplot(birch, aes(x=bud, y=dvr, color=tx)) + geom_point() + geom_smooth(method="lm") + facet_wrap(~species)
birch.mean<-birch[!is.na(birch$dvr),]
birch.mean$avg.rate<-ave(birch.mean$dvr, birch.mean$individ)
hist(birch.mean$avg.rate)
M1<-lm(avg.rate~tx+species, data=birch.mean)
display(M1)
qplot(species, avg.rate, data = birch.mean,
geom = "boxplot", color=tx) +
xlab("Species")+ylab("Mean DVR")
###### Re-evaluated % budburst #######
burst<-risk[!is.na(risk$dvr),]
burst<-distinct(burst, ID,individ)
burst<-as.data.frame(table(burst$individ))
burst<-burst%>%rename(individ=Var1)%>%rename(burst=Freq)
burst$individ<-as.character(burst$individ)
total<-risk
total<-distinct(total, ID,individ)
total<-as.data.frame(table(total$individ))
total<-total%>%rename(individ=Var1)%>%rename(total=Freq)
total$individ<-as.character(total$individ)
percent<-full_join(total, burst)
percent$perc.bb<-percent$burst/percent$total
percent$species<-substr(percent$individ, 1,6)
percent$tx<-NA
percent$tx<-as.character(percent$tx)
for(i in c(1:nrow(percent))){
for(j in c(1:nrow(risk)))
if(percent$individ[i]==risk$individ[j])
percent$tx[i]<-risk$tx[j]
}
percent$species<-substr(percent$individ, 1, 6)
percent<-subset(percent, species %in% betula)
mod<-lm(perc.bb~tx + species, data=percent)
display(mod)
qplot(species, perc.bb, data = percent,
geom = "boxplot", color=tx) +
xlab("Species")+ylab("Percent Budburst")
#write.csv(birch, file=("~/Documents/git/freezingexperiment/analyses/output/birches_buddata.csv"), row.names=FALSE)
#write.csv(birch, file=("~/Documents/git/freezingexperiment/analyses/output/birches_speciesdata.csv"), row.names=FALSE)
new.mod<-lmer(dvr~frost+bud+(1|individ/species), data=birch)
View(birch)
birch$ind<-substr(birch$individ, 9, 10)
new.mod<-lmer(dvr~frost+bud+(1|ind/species), data=birch)
display(new.mod)
write.csv(birch, file=("~/Documents/git/freezingexperiment/analyses/output/birches_buddata.csv"), row.names=FALSE)
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
# Load libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
library(lme4)
library(arm)
# Set Working Directory
setwd("~/Documents/git/freezingexperiment/analyses")
d <-read.csv("input/buds_traits.csv", header=TRUE)
bb<-read.csv("output/birches_buddata.csv", header=TRUE)
View(bb)
View(d)
dx<-dplyr::select(d, NEW, TX, Chlorophyll)
View(dx)
dx<-dplyr::select(d, NEW, TX, Bud, Chlorophyll)
View(dx)
dx$bud <- ave(dx$Bud, dx$NEW, dx$date, FUN = seq_along)
dx$bud <- ave(dx$Bud, dx$NEW, FUN = seq_along)
dx$species<-substr(dx$NEW, 1, 6)
dx<-filter(dx, species !="SAMRAC")
dx<-dx[!is.na(dx$Chlorophyll),]
bb$chlorophyll<-NA
for(i in c(1:nrow(bb))){
for(j in c(1:nrow(dx)))
if(bb$ID[i]==dx$NEW[j] & bb$bud[i]==dx$bud[j])
bb$chlorophyll[i]<-dx$Chlorophyll[j]
}
View(bb)
class(dx$Chlorophyll)
class(bb$chlorophyll)
class(dx$bud)
class(bb$bud)
dx$bud<-as.numeric(dx$bud)
bb$bud<-as.numeric(bb$bud)
for(i in c(1:nrow(bb))){
for(j in c(1:nrow(dx)))
if(bb$ID[i]==dx$NEW[j] & bb$bud[i]==dx$bud[j])
bb$chlorophyll[i]<-dx$Chlorophyll[j]
}
View(bb)
class(dx$NEW)
class(bb$ID)
dx$Chlorophyll<-as.character(dx$Chlorophyll)
for(i in c(1:nrow(bb))){
for(j in c(1:nrow(dx)))
if(bb$ID[i]==dx$NEW[j] & bb$bud[i]==dx$bud[j])
bb$chlorophyll[i]<-dx$Chlorophyll[j]
}
View(bb)
dx<-dplyr::select(d, NEW, TX, Bud, Chlorophyll)
dx$bud <- ave(dx$Bud, dx$NEW, FUN = seq_along)
dx$species<-substr(dx$NEW, 1, 6)
dx<-filter(dx, species !="SAMRAC")
dx<-dx[!is.na(dx$Chlorophyll),]
for(i in c(1:nrow(bb))){
for(j in c(1:nrow(dx)))
bb$chlorophyll<- ifelse(bb$ID[i]==dx$NEW[j] & bb$bud[i]==dx$bud[j], dx$Chlorophyll[j], 0)
}
View(bb)
for(i in c(1:nrow(bb))){
for(j in c(1:nrow(dx)))
if(bb$individ[i]==dx$NEW[j] & bb$bud[i]==dx$bud[j])
bb$chlorophyll<-dx$Chlorophyll[j]
}
View(bb)
for(i in c(1:nrow(bb))){
for(j in c(1:nrow(dx)))
if(bb$individ[i]==dx$NEW[j] & bb$bud[i]==dx$bud[j])
bb$chlorophyll[i]<-dx$Chlorophyll[j]
}
unique(bb$chlorophyll)
chl.mod<-lmer(chlorophyll~frost+bud+(1|species), data=bb)
display(chl.mod)
chl.mod<-lm(chlorophyll~frost+bud+species, data=bb)
display(chl.mod)
chl.mod<-lm(chlorophyll~frost+bud+species+frost*bud, data=bb)
display(chl.mod)
qplot(species, chlorophyll, data = bb,
geom = "boxplot", color=tx) +
xlab("Species")+ylab("Percent Budburst")
ggplot(bb, aes(x=bud, y=chlorophyll, color=frost)) + geom_point + geom_smooth(method="lm")
ggplot(bb, aes(x=bud, y=chlorophyll, color=frost)) + geom_point() + geom_smooth(method="lm")
ggplot(bb, aes(x=bud, y=chlorophyll, color=as.factor(frost)) + geom_point() + geom_smooth(method="lm")
dx$frz<-ifelse(d$TX=="A", 0, 1)
dx<-na.omit(dx)
dx$spp<-substr(dx$NEW, 0,6)
sp.mean<-aggregate(Chlorophyll~NEW + frz, dx, mean)
sp.mean$species<-substr(sp.mean$NEW, 0, 6)
qplot(spp, Chlorophyll, data = dx,
geom = "boxplot", color=TX) +
xlab("Species")+ylab("Chlorophyll measurement")
mod<-lmer(Chlorophyll~frz + (1|spp), data=dx)
summary(mod)
hist(dx$Chlorophyll[dx$frz==0])
hist(dx$Chlorophyll[dx$frz==1])
ggplot(bb, aes(x=bud, y=chlorophyll, color=as.factor(frost))) + geom_point() + geom_smooth(method="lm")
dx$ID<-paste(dx$NEW, dx$bud, sep="_")
bb$chlorophyll<-NA
for(i in c(1:nrow(bb))){
for(j in c(1:nrow(dx)))
if(bb$ID[i]==dx$ID[j])
bb$chlorophyll[i]<-dx$Chlorophyll[j]
}
unique(bb$chlorophyll)
table(unique(bb$chlorophyll))
chl.mod<-lm(chlorophyll~frost+bud+species+frost*bud, data=bb)
display(chl.mod)
qplot(species, chlorophyll, data = bb,
geom = "boxplot", color=tx) +
xlab("Species")+ylab("Percent Budburst")
ggplot(bb, aes(x=bud, y=chlorophyll, color=as.factor(frost))) + geom_point() + geom_smooth(method="lm")
